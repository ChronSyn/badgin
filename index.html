<!DOCTYPE html>
<html>
  <head>
    <link rel="icon" href="favicon.ico" />
    <title>badgin Demo</title>
    <meta
      http-equiv="origin-trial"
      content="Aj1FJCSnnsnMSEaSBA/84AhqsN5AFimqCAIaTtZlHiE2kekbpU+MnfpxMY2l1yfEhHcWOf5mXrUQTlcsXF8lVA0AAABaeyJvcmlnaW4iOiJodHRwczovL2FwcHJvdmFscy1jbG91ZC5naXRodWIuaW86NDQzIiwiZmVhdHVyZSI6IkJhZGdpbmciLCJleHBpcnkiOjE1NjIwNzQ3Nzl9"
    />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.7.5/css/bulma.min.css"
    />
    <script src="./build/index.iife.js"></script>
    <script>
      let value = 0
      const options = {
        favicon: {
          background: '#424242',
          color: 'rgba(255, 255, 255)',
        },
      }

      function setMethod(method) {
        options.method = method
      }

      function increaseBadge() {
        value++
        badgin.set(value, options)
      }

      function decreaseBadge() {
        value--
        badgin.set(value, options)
      }

      function clearBadge() {
        badgin.clear(options)
      }

      // Set initial value
      badgin.set(value, options)

      // Add to Home Screen
      let deferredPrompt
      const btnAdd = document.getElementById('butInstall')
      const divInstallStatus = document.getElementById('installAvailable')

      function install() {
        if (!deferredPrompt) {
          alert('It seems that you cannot install Progress Web Apps.')
          return
        }

        // Show the prompt
        deferredPrompt.prompt()

        // Wait for the user to respond to the prompt
        deferredPrompt.userChoice.then(resp => {
          console.log(JSON.stringify(resp))
        })
      }

      window.addEventListener('beforeinstallprompt', e => {
        // Prevent Chrome 67 and earlier from automatically showing the prompt
        e.preventDefault()

        // Stash the event so it can be triggered later
        deferredPrompt = e

        // Update UI notify the user they can add to home screen
        btnAdd.removeAttribute('disabled')
      })
    </script>
    <style>
      @media (display-mode: standalone) {
        #requiresStandalone {
          display: none;
        }
      }
    </style>
  </head>
  <body>
    <section class="section">
      <div class="container">
        <h1 class="title">Method</h1>

        <input
          type="radio"
          id="method_automatically"
          name="method"
          value=""
          onchange="setMethod();"
          class="radio"
          checked
        />
        <label for="method_automatically">Automatically</label>
        <br />

        <input
          type="radio"
          id="method_badging"
          name="method"
          value="Badging"
          onchange="setMethod('Badging');"
          class="radio"
        />
        <label for="method_badging">Badging API</label>
        <div>
          <article class="message is-warning" id="requiresStandalone">
            <div class="message-body">
              This demo must be run as an installed Progressive Web App, and
              it's must be opened/running as a <b>standalone</b> window.
              <br />
              <button type="button" onclick="install();" class="button">
                Install
              </button>
            </div>
          </article>
        </div>

        <input
          type="radio"
          id="method_favicon"
          name="method"
          value="Favicon"
          onchange="setMethod('Favicon');"
          class="radio"
        />
        <label for="method_favicon">Favicon</label>
        <br />

        <input
          type="radio"
          id="method_title"
          name="method"
          value="Title"
          onchange="setMethod('Title');"
          class="radio"
        />
        <label for="method_title">Title</label>
      </div>
    </section>

    <section class="section">
      <div class="container">
        <h1 class="title">Value</h1>
        <button onclick="increaseBadge();" class="button">Increase</button>
        <button onclick="decreaseBadge();" class="button">Decrease</button>
        <button onclick="clearBadge();" class="button">Clear</button>
      </div>
    </section>
  </body>
</html>
